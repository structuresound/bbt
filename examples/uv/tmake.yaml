---
git:
  repository: libuv/libuv
  tag: v1.11.0
target>:
  flags:
    linker:
      =:
        pthread: true
        m: true
      +linux:
        dl: true
        rt: true
    c:
      =:
        fvisibility: hidden
        g: true
        std: gnu89
        pedantic: true
        Wall: true
        Wextra: true
        Wno-unused-parameter: true
      +mac:
        D_DARWIN_USE_64_BIT_INODE: 1
        D_DARWIN_UNLIMITED_SELECT: 1
path:
  includeDirs:
  - source/src
  install:
    headers:
    - from: source/include
      to: include/uv
configure:
  replace:
    include_uv:
      matching:
      - src/**/*.{c,h}
      inputs:
        uv:
        - '#include "uv.h"'
        - '#include <uv/uv.h>'
        tree:
        - '#include "tree.h"'
        - '#include <uv/tree.h>'
        pthread-barrier:
        - '#include "pthread-barrier.h"'
        - '#include <uv/pthread-barrier.h>'
generate:
  ninja:
    matching:
      =linux:
      - src/unix/*.c
      =mac, ios:
      - src/unix/*.c
      - '!src/unix/aix*'
      - '!src/unix/linux*'
      - '!src/unix/android*'
      - '!src/unix/os390*'
      - '!src/unix/netbsd*'
      - '!src/unix/openbsd*'
      - '!src/unix/pthread-fixes.c'
      - '!src/unix/freebsd*'
      - '!src/unix/sunos*'
build:
  ninja: {}
